# 쿠기, 스토리지, 세션

## 등장 배경

HTTP는 요청과 응답으로 이뤄지는 하나의 사이클이 끝나면, 연결이 끊어지는 무상태성을 띄어서 클라이언트의 상태를 보존하지 않습니다. 이러한 HTTP의 단점을 보완하고자 쿠키와 웹 스토리지를 사용하는데요, 클라이언트의 상태를 서버가 아닌 클라이언트에 저장해두고 필요시마다 데이터를 꺼내서 서버에 전달하는 방식인 쿠키와 웹 스토리지를 사용합니다.

## 쿠키

클라이언트 단에 저장하는 작은 텍스트 파일로 만료 기간이 존재합니다. 서버가 HTTP 응답시 set-cookie를 통해 쿠키 생성하여 전달해주면 클라이언트는 매 HTTP Request시 HTTP Header에 쿠키담아서 전송합니다.

쿠키는 만료기간이 있기 때문에 만료 기간 전이라면, 브라우저에 항상 저장되어 있어 요청시 언제라도 사용 가능하지만 만료됬다면, 서버에 새로 요청하여 쿠키를 발급해야 합니다.

### 쿠키의 징점

> 1. 대부분의 브라우저가 지원
> 2. 데이터 유효기간 지정 가능 (ex. 1 hour, 1 day)
> 3. XSS로부터 안전 - 서버에서 쿠키의 httpOnly 옵션을 설정하면, Js에서 쿠키에 접근 자체가 불가능

### 쿠키의 단점

> 1. 매우 작은 데이터 저장 용량 (4kb)
> 2. 매번 서버에 HTTP 요청시 같이 전달되어 서버에 부담
> 3. 암호화가 안되어 있어 유저 정보 도난 위험
> 4. 문자열만 저장 가능
> 5. CSRF(사이트 간 요청 위조) 위협 - 공격자가 사용자의 요청을 가로챈 뒤 사용자의 의지와 상관없이 보안적으로 위험한 행동을 하게끔 변조하여 부당 이익을 취하는 행위

## 웹 스토리지

웹 스토리지는 클라이언트에 데이터를 저장할 수 있도록 HTML5부터 나온 새로운 방식의 데이터 저장소로 로컬 스토리지와 세션 스토리지가 존재합니다. 웹 스토리지는 key와 value 쌍의 형태로 데이터 저장되며 window 객체의 프로퍼티로 존재합니다.

**로컬 스토리지**는 데이터 영구 저장이 가능하고, window.localStorage를 사용합니다.

**세션 스토리지**는 브라우저 탭/윈도우가 닫히면 스토리지가 초기화되며 window.sessionStorage 객체를 사용합니다.

### 웹 스토리지의 징점

> 1. 서버에 불필요하게 데이터 저장 x
> 2. 넉넉한 데이터 저장 용량 (모바일: 2.5MB, 데스크탑: 5~10MB)
> 3. 문자열 외에도 자바스크립트의 모든 원시형 데이터와 객체 저장 가능
> 4. 도메인 단위로 접근이 제한되는 CORS 특성 덕분에 CSRF로부터 안전

### 웹 스토리지의 단점

> 1. HTML5를 지원하는 브라우저만 사용 가능
> 2. XSS로부터 위험 - local storage에 접근하는 Js 코드로 쉽게 접근 가능

> 출처: https://velog.io/@hs0217/%EC%BF%A0%ED%82%A4-%EB%A1%9C%EC%BB%AC-%EC%8A%A4%ED%86%A0%EB%A6%AC%EC%A7%80-%EC%84%B8%EC%85%98-%EC%8A%A4%ED%86%A0%EB%A6%AC%EC%A7%80

## 세션

세션은 쿠키를 기반하고 있지만, 사용자 정보 파일을 브라우저에 저장하는 쿠키와 달리 세션은 서버 측에서 관리합니다. 서버에서는 클라이언트를 구분하기 위해 **세션 ID를 부여**하며 웹 브라우저가 서버에 접속해서 브라우저를 종료할 때까지 인증상태를 유지합니다.

사용자에 대한 정보를 서버에 두기 때문에 쿠키보다 보안에 좋지만, 사용자가 많아질수록 서버 메모리를 많이 차지하게 됩니다. \*즉 동접자 수가 많은 웹 사이트인 경우 서버에 과부하를 주게 되므로 성능 저하의 요인이 됨.
클라이언트가 Request를 보내면, 해당 서버의 엔진이 클라이언트에게 유일한 ID를 부여하는 데 이것이 세션ID.
**로컬 스토리지**는 데이터 영구 저장이 가능하고, window.localStorage를 사용합니다.

**세션 스토리지**는 브라우저 탭/윈도우가 닫히면 스토리지가 초기화되며 window.sessionStorage 객체를 사용합니다.

### 웹 스토리지의 징점

> 1. 서버에 불필요하게 데이터 저장 x
> 2. 넉넉한 데이터 저장 용량 (모바일: 2.5MB, 데스크탑: 5~10MB)
> 3. 문자열 외에도 자바스크립트의 모든 원시형 데이터와 객체 저장 가능
> 4. 도메인 단위로 접근이 제한되는 CORS 특성 덕분에 CSRF로부터 안전

### 웹 스토리지의 단점

> 1. HTML5를 지원하는 브라우저만 사용 가능
> 2. XSS로부터 위험 - local storage에 접근하는 Js 코드로 쉽게 접근 가능
